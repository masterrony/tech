{"version":3,"sources":["../../src/controller/adminController.js"],"names":["adminController","post","req","res","body","password","username","process","env","ADMIN_PASSWORD","ADMIN_USERNAME","json","scs","token","iat","Math","floor","Date","now","APP_KEY","expiresIn","get","verifyToken","skip","Number","query","_start","limit","_end","sort","_sort","order","users","totalCount","map","user","id","_id","header","send","params","put","delete"],"mappings":"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","file":"adminController.js","sourcesContent":["import { Router } from 'express'\r\nimport { async } from 'regenerator-runtime';\r\nimport { sign } from \"jsonwebtoken\";\r\nimport { verifyToken } from '../middlewares/verifyToken';\r\n\r\nimport { \r\n  getUsers,\r\n  getOneUser,\r\n  updateOneUser,\r\n  deleteOneUser\r\n} from \"../model/actions/UserModel\";\r\n\r\nconst adminController = Router()\r\n\r\nadminController.post('/auth', (req, res) => {\r\n  const { password, username } = req.body\r\n  if(password != process.env.ADMIN_PASSWORD || username != process.env.ADMIN_USERNAME)\r\n    return res.json({ scs: 0 })\r\n\r\n  const token = sign(\r\n    { iat: Math.floor(Date.now() / 1000) },\r\n    process.env.APP_KEY,\r\n    { expiresIn: '12h' }\r\n  )\r\n\r\n  return res.json({ scs:1, token })\r\n})\r\n\r\nadminController.get('/users', verifyToken, async (req, res) => {\r\n  const skip = Number(req.query._start)\r\n  const limit = Number(req.query._end) - skip\r\n  const sort = req.query._sort == 'id' ? '_id' : req.query._sort\r\n  const order = req.query._sort == 'ASC' ? -1 : 1\r\n\r\n  let { users, totalCount } = await getUsers({ skip, limit, sort, order })\r\n  users = users.map(user => { return { ...user, id: user._id } })\r\n  res.header('X-Total-Count', totalCount)\r\n  return res.send(users)\r\n})\r\n\r\nadminController.get('/users/:id', verifyToken, async (req, res) => {\r\n  let user = await getOneUser(req.params.id)\r\n  user = { ...user, id: user._id }\r\n  return res.send(user)\r\n})\r\n\r\nadminController.put('/users/:id', verifyToken, async (req, res) => {\r\n  let user = await updateOneUser(req.body)\r\n  user = { ...user, id: user._id }\r\n  return res.send(user)\r\n})\r\n\r\nadminController.delete('/users/:id', verifyToken, async (req, res) => {\r\n  let user = await deleteOneUser(req.params.id)\r\n  user = { ...user, id: user._id }\r\n  return res.send(user)\r\n})\r\n\r\nexport default adminController"]}